graph TD
    A[éå†æ¯ä¸ªç‰ˆæœ¬] --> B[æŸ¥è¯¢æ•°æ®åº“CursorUpdateè¡¨]
    B --> C[æ£€æŸ¥ç‰ˆæœ¬æ˜¯å¦å­˜åœ¨]
    C -->|å­˜åœ¨| D[ğŸ“‹ ç‰ˆæœ¬å·²å­˜åœ¨]
    C -->|ä¸å­˜åœ¨| E[ğŸ†• æ–°ç‰ˆæœ¬]
    
    D --> F[è·³è¿‡APIè°ƒç”¨]
    F --> G[è·å–æ•°æ®åº“ä¸­çš„æ•°æ®]
    G --> H[å·²å­˜åœ¨æ•°æ®åŒ…å«:]
    H --> I[- åŸæ–‡å†…å®¹<br/>- ç¿»è¯‘å†…å®¹<br/>- åˆ†æç»“æœ<br/>- ç‰ˆæœ¬ä¿¡æ¯]
    I --> J[ä½¿ç”¨ç°æœ‰æ•°æ®åˆ›å»ºCollectorItem]
    J --> K[æ ‡è®°ä¸ºexistingçŠ¶æ€]
    K --> L[é‡‡é›†ç»Ÿè®¡: existing_versions++]
    
    E --> M[è°ƒç”¨3ä¸ªAPI]
    M --> N[å¢åŠ APIè°ƒç”¨è®¡æ•°]
    N --> O[æ–°ç‰ˆæœ¬æ•°æ®åŒ…å«:]
    O --> P[- åŸæ–‡å†…å®¹<br/>- ç¿»è¯‘å†…å®¹<br/>- åˆ†æç»“æœ<br/>- ç‰ˆæœ¬ä¿¡æ¯]
    P --> Q[åˆ›å»ºæ–°çš„CollectorItem]
    Q --> R[æ ‡è®°ä¸ºnewçŠ¶æ€]
    R --> S[é‡‡é›†ç»Ÿè®¡: new_versions++]
    
    L --> T[æ·»åŠ åˆ°ç»“æœåˆ—è¡¨]
    S --> T
    T --> U[ç»§ç»­ä¸‹ä¸€ä¸ªç‰ˆæœ¬]
    
    U --> V[æ‰€æœ‰ç‰ˆæœ¬å¤„ç†å®Œæˆ]
    V --> W[ç”Ÿæˆé‡‡é›†ç»Ÿè®¡æŠ¥å‘Š]
    W --> X[è¾“å‡ºç»Ÿè®¡ä¿¡æ¯:]
    X --> Y[- æ€»ç‰ˆæœ¬æ•°<br/>- æ–°ç‰ˆæœ¬æ•°<br/>- å·²å­˜åœ¨ç‰ˆæœ¬æ•°<br/>- APIè°ƒç”¨æ€»æ•°]
    
    style A fill:#e1f5fe
    style D fill:#e8f5e8
    style E fill:#fff3e0
    style W fill:#f3e5f5
    style Y fill:#e1f5fe
    
    classDef database fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef existing fill:#e8f5e8,stroke:#4caf50,stroke-width:2px
    classDef new fill:#fff3e0,stroke:#ff8f00,stroke-width:2px
    classDef stats fill:#f3e5f5,stroke:#e91e63,stroke-width:2px
    
    class B,C,G database
    class D,F,J,K,L existing
    class E,M,Q,R,S new
    class W,X,Y stats 